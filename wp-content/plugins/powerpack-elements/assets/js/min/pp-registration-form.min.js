!function(f){window.onLoadPPReCaptcha=function(){var r,e=f(".pp-grecaptcha");0<e.length&&e.each(function(e){var s=f(this),i=s.attr("data-widgetid"),t=f(this).attr("id");typeof i!=typeof undefined&&!1!==i||(s.attr("id",t),r=grecaptcha.render(t,{sitekey:s.data("sitekey"),theme:s.data("theme"),size:s.data("validate"),callback:function(e){""!=e&&(s.attr("data-pp-grecaptcha-response",e),"invisible"==s.data("validate"))&&s.closest(".elementor-widget").find(".pp-submit-button").trigger("click")}}),s.attr("data-widgetid",r))})},(PPRegistrationForm=function(e,s){this.settings=s,this.nodeClass=e,this.i18n=s.i18n,this.messages=s.i18n.messages,this.form=f(this.nodeClass).find(".pp-registration-form"),this.fields={},this.errorCodes={},this._init()}).prototype={settings:{},nodeClass:"",messages:{},isValid:!0,fields:{},errorCodes:{},_init:function(){this.form.length<1||(this._initFields(),this._bindErrorCodes(),this._bindEvents(),this._initReCaptcha())},_initReCaptcha:function(){var e=this.nodeClass.find(".pp-grecaptcha");elementorFrontend.isEditMode()&&undefined==e.attr("data-widgetid")&&onLoadPPReCaptcha()},_initFields:function(){this.fields={user_login:this.form.find('.pp-rf-field[data-field-type="user_login"]'),user_email:this.form.find('.pp-rf-field[data-field-type="user_email"]'),user_pass:this.form.find('.pp-rf-field[data-field-type="user_pass"]'),confirm_user_pass:this.form.find('.pp-rf-field[data-field-type="confirm_user_pass"]'),user_url:this.form.find('.pp-rf-field[data-field-type="user_url"]'),first_name:this.form.find('.pp-rf-field[data-field-type="first_name"]'),last_name:this.form.find('.pp-rf-field[data-field-type="last_name"]'),consent:this.form.find('.pp-rf-field[data-field-type="consent"]'),recaptcha:this.form.find('.pp-rf-field[data-field-type="recaptcha"]')},Object.keys(this.fields).forEach(f.proxy(function(e){var s;void 0!==e&&0<(s=this.fields[e].find('.pp-rf-control[name="'+e+'"]')).length&&(this.fields[e].control=s)},this))},_bindErrorCodes:function(){this.errorCodes={empty_email:"user_email",invalid_email:"user_email",email_exists:"user_email",username_wp_error:"user_login",invalid_username:"user_login",username_exists:"user_login",password:"user_pass",password_mismatch:"confirm_user_pass",invalid_url:"user_url",recaptcha_php_ver:"recaptcha",recaptcha_missing_key:"recaptcha"}},_bindEvents:function(){0<this.fields.user_pass.find(".pp-rf-toggle-pw").length&&this.fields.user_pass.find(".pp-rf-toggle-pw").on("click",f.proxy(this._passwordToggle,this)),this.settings.pws_meter&&"undefined"!=typeof wp.passwordStrength&&this.fields.user_pass.control.on("input",f.proxy(this._beginPwsMeter,this)),this.nodeClass.find(".pp-button").on("click",f.proxy(this._submit,this))},_getFieldByCode:function(e){return"undefined"!=typeof this.errorCodes[e]&&(e=this.errorCodes[e],this.fields[e])},_getFormData:function(){var e=new FormData(this.nodeClass.find(".pp-registration-form")[0]);return e.append("referrer",location.toString()),e},_passwordToggle:function(){var e=this.fields.user_pass;"text"===e.control.attr("type")?(e.control.attr("type","password"),e.find(".pp-rf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.show).find("span").removeClass("fa-eye-slash").addClass("fa-eye")):(e.control.attr("type","text"),e.find(".pp-rf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.hide).find("span").removeClass("fa-eye").addClass("fa-eye-slash"))},_beginPwsMeter:function(e){var e=f(e.target).val(),s=this.fields.user_pass.find(".pp-rf-pws-status"),i=wp.passwordStrength.userInputBlacklist();switch(this.fields.confirm_user_pass.length,s.removeClass("short bad good strong"),wp.passwordStrength.meter(e,i,!1)){case 0:s.addClass("short").html(pwsL10n["short"]);break;case 1:s.addClass("bad").html(pwsL10n.bad);break;case 2:case 3:s.addClass("good").html(pwsL10n.good);break;case 4:s.addClass("strong").html(pwsL10n.strong)}""===e?s.removeClass("short bad good strong").html(""):this._removeErrorClass(this.fields.user_pass)},_submit:function(e){this.isValid=!0;var i,s,t=this.form,r=this.nodeClass.find(".pp-button"),a=this._getFormData(),d=this.nodeClass.find(".pp-grecaptcha"),n=d.data("pp-grecaptcha-response"),o=this.settings.ajaxurl,l=t.closest(".pp-rf-wrap").data("post-id"),p=(t.data("template-id"),t.data("template-node-id"),t.closest(".elementor-widget-pp-registration-form").data("id"));e.preventDefault(),r.hasClass("pp-disabled")||(t.find(".pp-rf-field").removeClass("pp-rf-field-error"),i=this,t.find(".pp-rf-field.elementor-mark-required").each(function(){var e=f(this),s=e.data("field-type"),s=f(this).find('[name="'+s+'"]');0<s.length&&("checkbox"===s.attr("type")||"radio"===s.attr("type")?s.is(":checked")?i._fieldHasError(e)&&i._removeErrorClass(e):(i.isValid=!1,i._addErrorClass(e)):s.val()&&""!==s.val()?i._fieldHasError(e)&&i._removeErrorClass(e):(i.isValid=!1,i._addErrorClass(e)))}),0<this.fields.user_email.length&&(""===(e=this.fields.user_email.find('input[type="email"]')).val()?(this.isValid=!1,this._addErrorClass(this.fields.user_email)):/\S+@\S+\.\S+/.test(e.val())?this._fieldHasError(this.fields.user_email)&&this._removeErrorClass(this.fields.user_email):(this.isValid=!1,this._removeErrorClass(this.fields.user_email),this._addInlineError(this.fields.user_email,this.messages.error.invalid_email))),0<this.fields.user_pass.length&&""!==(s=this.fields.user_pass.control).val()&&s.val().length<this.settings.min_pass_length&&(this.isValid=!1,this._addInlineError(this.fields.user_pass,this.messages.error.password_length)),0<this.fields.confirm_user_pass.length&&(e=this.fields.confirm_user_pass.find('input[name="confirm_user_pass"]').val(),s=this.fields.user_pass.find('input[name="user_pass"]').val(),""!==e)&&btoa(e)!==btoa(s)&&(this.isValid=!1,this._addInlineError(this.fields.confirm_user_pass,this.messages.error.password_mismatch)),0<d.length&&this.isValid&&(void 0===n||!1===n?"normal"==d.data("validate")?(this.isValid=!1,this._addErrorClass(this.fields.recaptcha)):"invisible"==d.data("validate")&&grecaptcha.execute(d.data("widgetid")):this._removeErrorClass(this.fields.recaptcha)),this.isValid&&(r.addClass("pp-disabled"),0<d.length&&a.append("recaptcha",!0),n&&a.append("recaptcha_response",n),a.append("node_id",p),a.append("action","ppe_register_user"),a.append("security",t.data("nonce")),a.append("post_id",l),f.ajax({url:o,type:"POST",dataType:"json",data:a,processData:!1,contentType:!1,success:f.proxy(this._submitComplete,this),error:this._onError})))},_submitComplete:function(e){var s,i,t=this.nodeClass.find(" .pp-rf-success-none");if("undefined"==typeof e.success||!0!==e.success)return f(this.nodeClass).find(".pp-button").removeClass("pp-disabled"),"undefined"!=typeof e.data.message?(i=e.data,s=this._getFieldByCode(i.code),i="undefined"!=typeof this.messages.error[i.code]?this.messages.error[i.code]:i.message,s&&0<s.length?this._addInlineError(s,i):(this.nodeClass.find(" .pp-rf-failed-error").html(i),this.nodeClass.find(" .pp-rf-failed-error").fadeIn())):this.nodeClass.find(" .pp-rf-failed-error").fadeIn(),!1;this.nodeClass.find(" .pp-rf-failed-error").fadeOut(),"yes"!==e.data.auto_login||"undefined"!=typeof e.data.redirect_url&&""!==e.data.redirect_url?"undefined"!=typeof e.data.redirect_url?window.location.href=e.data.redirect_url:(0<t.length?t:(this.nodeClass.find(".pp-registration-form").hide(),this.nodeClass.find(".pp-after-submit-action.pp-rf-success"))).fadeIn():window.location.reload()},_onError:function(e,s){console.log(s)},_addInlineError:function(e,s){e.find(".pp-rf-error-inline").remove(),e.addClass("pp-rf-field-error").append('<span class="pp-rf-error-inline">'+s+"</span>")},_addErrorClass:function(e){e.addClass("pp-rf-validation-error")},_removeErrorClass:function(e){e.removeClass("pp-rf-validation-error")},_fieldHasError:function(e){return e.hasClass("pp-rf-validation-error")}}}(jQuery);